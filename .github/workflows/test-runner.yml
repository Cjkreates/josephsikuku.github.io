name: Portfolio CI/CD Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  test-portfolio:
    runs-on: ubuntu-latest
    name: Test Portfolio Website
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Show portfolio structure
      run: |
        echo "ğŸ“ Portfolio Website Structure:"
        echo "Current directory: $(pwd)"
        ls -la
        echo ""
        echo "ğŸŒ Website files:"
        find . -name "*.html" -o -name "*.md" | head -10
        
    - name: Run portfolio tests
      run: |
        echo "ğŸ§ª Testing portfolio website..."
        if [ -f "test-website.py" ]; then
          python test-website.py
        else
          echo "âŒ test-website.py not found"
          echo "Creating basic validation..."
          if [ -f "index.html" ] && [ -f "README.md" ]; then
            echo "âœ… Basic portfolio structure valid"
          else
            echo "âŒ Missing essential files"
            exit 1
          fi
        fi
        
    - name: Validate HTML files
      run: |
        echo "ğŸ” Validating HTML files..."
        html_files=$(find . -name "*.html" | head -5)
        for file in $html_files; do
          if [ -f "$file" ]; then
            echo "âœ… $file exists"
            if grep -q "<html\|<!DOCTYPE" "$file"; then
              echo "  âœ… Valid HTML structure"
            else
              echo "  âš ï¸  May not be standard HTML"
            fi
          fi
        done

  deploy-portfolio:
    needs: test-portfolio
    runs-on: ubuntu-latest
    name: Deploy Portfolio
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup GitHub Pages
      uses: actions/configure-pages@v3
      
    - name: Upload portfolio to Pages
      uses: actions/upload-pages-artifact@v2
      with:
        path: '.'
        
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v2
      
    - name: Show portfolio URL
      run: |
        echo "ğŸ‰ Portfolio Successfully Deployed!"
        echo "ğŸŒ Live at: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
        echo ""
        echo "ğŸ“Š This is your PERSONAL PORTFOLIO website!"
        echo "   It updates automatically with every change!"

  success:
    needs: deploy-portfolio
    runs-on: ubuntu-latest
    steps:
    - name: Portfolio deployment complete!
      run: |
        echo "ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰"
        echo "ğŸš€ PORTFOLIO CI/CD SUCCESS! ğŸš€"
        echo "ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰ ğŸ‰"
        echo ""
        echo "âœ… Your portfolio is automatically tested"
        echo "âœ… Your portfolio is automatically deployed" 
        echo "âœ… Professional CI/CD pipeline active"
        echo ""
        echo "Visit: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"